@model AttendanceSystem118.Models.Class

@{
    ViewData["Title"] = Model.Name;
    ViewBag.ClassId = Model.Id;
    
    var totalStudents = Model.Students.Count;
    var averageAttendance = 0.0;
    
    if (totalStudents > 0)
    {
        var studentsWithAttendance = Model.Students.Where(s => s.Attendances.Any()).ToList();
        if (studentsWithAttendance.Any())
        {
            averageAttendance = studentsWithAttendance.Average(s => 
                s.Attendances.Any() ? (double)s.Attendances.Count(a => a.IsPresent) / s.Attendances.Count * 100 : 0
            );
        }
    }
}

<div class="page-header">
    <div>
        <h1>@Model.Name</h1>
        <div class="class-meta">
            <span class="badge">@Model.Subject</span>
            @if (!string.IsNullOrEmpty(Model.Section))
            {
                <span class="badge badge-secondary">Section @Model.Section</span>
            }
        </div>
    </div>
    <div class="header-actions">
        <a asp-controller="Student" asp-action="Create" asp-route-classId="@Model.Id" class="btn btn-primary">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            Add Student
        </a>
        <a asp-controller="Student" asp-action="MarkAttendance" asp-route-classId="@Model.Id" class="btn btn-success">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="9 11 12 14 22 4"></polyline>
                <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
            </svg>
            Mark Attendance
        </a>
    </div>
</div>

<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-icon" style="background: #e3f2fd;">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#2196f3" stroke-width="2">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
        </div>
        <div>
            <div class="stat-value">@totalStudents</div>
            <div class="stat-label">Total Students</div>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="stat-icon" style="background: #e8f5e9;">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#4caf50" stroke-width="2">
                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
            </svg>
        </div>
        <div>
            <div class="stat-value">@averageAttendance.ToString("F1")%</div>
            <div class="stat-label">Average Attendance</div>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon" style="background: #fff3e0;">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#ff9800" stroke-width="2">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
        </div>
        <div>
            <div class="stat-value">@Model.CreatedDate.ToString("MMM dd")</div>
            <div class="stat-label">Created Date</div>
        </div>
    </div>
</div>

@if (!Model.Students.Any())
{
    <div class="empty-state">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
            <circle cx="9" cy="7" r="4"></circle>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
        </svg>
        <h2>No Students Yet</h2>
        <p>Add your first student to start tracking attendance</p>
        <a asp-controller="Student" asp-action="Create" asp-route-classId="@Model.Id" class="btn btn-primary">Add Student</a>
    </div>
}
else
{
    <div class="table-container">
        <table class="table">
            <thead>
                <tr>
                    <th>Student Name</th>
                    <th>Enrollment Number</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Attendance</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var student in Model.Students)
                {
                    var totalClasses = student.Attendances.Count;
                    var presentClasses = student.Attendances.Count(a => a.IsPresent);
                    var attendancePercentage = totalClasses > 0 ? (double)presentClasses / totalClasses * 100 : 0;
                    
                    <tr>
                        <td>
                            <div class="student-name">
                                <div class="avatar">@student.Name.Substring(0, 1).ToUpper()</div>
                                @student.Name
                            </div>
                        </td>
                        <td>@student.EnrollmentNumber</td>
                        <td>@(student.Email ?? "-")</td>
                        <td>@(student.Phone ?? "-")</td>
                        <td>
                            <div class="attendance-badge @(attendancePercentage >= 75 ? "badge-success" : attendancePercentage >= 50 ? "badge-warning" : "badge-danger")">
                                @attendancePercentage.ToString("F1")%
                            </div>
                        </td>
                        <td>
                            <div class="action-buttons">
                                <a asp-controller="Student" asp-action="Profile" asp-route-id="@student.Id" class="btn-icon" title="View Profile">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                        <circle cx="12" cy="7" r="4"></circle>
                                    </svg>
                                </a>
                                <form asp-controller="Student" asp-action="Delete" asp-route-id="@student.Id" method="post" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this student?');">
                                    @Html.AntiForgeryToken()
                                    <button type="submit" class="btn-icon btn-danger" title="Delete">
                                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <polyline points="3 6 5 6 21 6"></polyline>
                                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                        </svg>
                                    </button>
                                </form>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}